version: "3.8"

services:
    backend:
        build:
            context: ./server
        container_name: soundshare-backend
        environment:
            - NODE_ENV=production
            - PORT=1337
        ports:
            - "8085:1337"
        restart: unless-stopped
        networks:
            - soundshare-network

    nginx:
        image: nginx:alpine
        container_name: soundshare-nginx
        ports:
            - "8084:80"
        volumes:
            - ./nginx/conf.d:/etc/nginx/conf.d
            - ./frontend/dist:/usr/share/nginx/html
        depends_on:
            - backend
        networks:
            - soundshare-network

    # certbot:
    #   image: certbot/certbot
    #   container_name: soundshare-certbot
    #   volumes:
    #     - ./certbot/conf:/etc/letsencrypt
    #     - ./certbot/www:/var/www/certbot
    #   entrypoint: >
    #     sh -c "trap exit TERM; while :; do sleep 12h & wait $${!}; certbot renew; done"
    #   networks:
    #     - soundshare-network

networks:
    soundshare-network:
        driver: bridge
